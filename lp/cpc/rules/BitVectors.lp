require open cpc.Core Stdlib.Set cpc.programs.BitVectors cpc.programs.PolyNorm cpc.programs.Bitblasting;
sequential symbol !bv_smulo_elim_rec [n : τ Int]: τ ((BitVec n) ⤳ (BitVec n) ⤳ (BitVec (1)) ⤳ (BitVec (1)) ⤳ Int ⤳ Int ⤳ BitVec (1));
rule !bv_smulo_elim_rec ($xa) ($xb) ($ppc) ($res) ($nm2) ($nm2) ↪ $res
with !bv_smulo_elim_rec ($xa) ($xb) ($ppc) ($res) ($i) ($nm2) ↪ (let ia ≔ eo⋅⋅add ($nm2) (eo⋅⋅neg ($i)) in (let ip1 ≔ eo⋅⋅add ($i) (1) in (let ppcn ≔ bvor ($ppc) (bvor (extract ia ia ($xa)) (eo⋅⋅to_bin m (0))) in !bv_smulo_elim_rec ($xa) ($xb) ppcn (bvor ($res) (bvor (bvand (extract ip1 ip1 ($xb)) (bvand ppcn (eo⋅⋅not (eo⋅⋅to_bin m (0))))) (eo⋅⋅to_bin m (0)))) ip1 ($nm2))));
symbol !bv_smulo_elim [n : τ Int] (a : τ (BitVec n)) (b : τ (BitVec n))≔ (let w ≔ !bv_bitwidth (eo⋅⋅typeof a) in (let wm1 ≔ eo⋅⋅add w (-1) in (let one ≔ eo⋅⋅to_bin (1) (1) in eo⋅⋅ite (eo⋅⋅eq w (1)) (and (= (bvand a (bvand b (eo⋅⋅not (eo⋅⋅to_bin m (0))))) one)) ((let mul ≔ bvmul (sign_extend (1) a) (bvmul (sign_extend (1) b) (eo⋅⋅to_bin m (1))) in eo⋅⋅ite (eo⋅⋅eq w (2)) (and (= (bvxor (extract w w mul) (bvxor (extract wm1 wm1 mul) (eo⋅⋅to_bin m (0)))) one)) ((let xa ≔ bvxor a (bvxor (sign_extend wm1 (extract wm1 wm1 a)) (eo⋅⋅to_bin m (0))) in (let xb ≔ bvxor b (bvxor (sign_extend wm1 (extract wm1 wm1 b)) (eo⋅⋅to_bin m (0))) in (let wm2 ≔ eo⋅⋅add w (-2) in (let ppc ≔ extract wm2 wm2 xa in (let res ≔ !bv_smulo_elim_rec xa xb ppc (bvand (extract (1) (1) xb) (bvand ppc (eo⋅⋅not (eo⋅⋅to_bin m (0))))) (1) wm2 in and (= (bvor res (bvor (bvxor (extract w w mul) (bvxor (extract wm1 wm1 mul) (eo⋅⋅to_bin m (0)))) (eo⋅⋅to_bin m (0)))) one))))))))))));
sequential symbol !bv_umulo_elim_rec [n : τ Int]: τ ((BitVec n) ⤳ (BitVec n) ⤳ (BitVec (1)) ⤳ (BitVec (1)) ⤳ Int ⤳ Int ⤳ BitVec (1));
rule !bv_umulo_elim_rec ($a) ($b) ($uppc) ($res) ($n) ($n) ↪ $res
with !bv_umulo_elim_rec ($a) ($b) ($uppc) ($res) ($i) ($n) ↪ (let ia ≔ eo⋅⋅add ($n) (-1) (eo⋅⋅neg ($i)) in (let ip1 ≔ eo⋅⋅add ($i) (1) in (let uppcn ≔ bvor (extract ia ia ($a)) (bvor ($uppc) (eo⋅⋅to_bin m (0))) in eo⋅⋅cons bvor (bvand (extract ($i) ($i) ($b)) (bvand ($uppc) (eo⋅⋅not (eo⋅⋅to_bin m (0))))) (!bv_umulo_elim_rec ($a) ($b) uppcn ($res) ip1 ($n)))));
symbol !bv_umulo_elim [n : τ Int] (a : τ (BitVec n)) (b : τ (BitVec n))≔ (let w ≔ !bv_bitwidth (eo⋅⋅typeof a) in eo⋅⋅ite (eo⋅⋅eq w (1)) false ((let wm1 ≔ eo⋅⋅add w (-1) in (let zero ≔ eo⋅⋅to_bin (1) (0) in (let uppc ≔ extract wm1 wm1 a in (let mul ≔ bvmul (concat zero a) (bvmul (concat zero b) (eo⋅⋅to_bin m (1))) in (let res ≔ !bv_umulo_elim_rec a b uppc (bvor (extract w w mul) (eo⋅⋅to_bin m (0))) (1) w in and (= res (eo⋅⋅to_bin (1) (1))))))))));
sequential symbol !bv_mk_bitwise_slicing_rec [n : τ Int] [m : τ Int] [k : τ Int]: τ (((BitVec n) ⤳ (BitVec n) ⤳ BitVec n) ⤳ (BitVec k) ⤳ (BitVec k) ⤳ (BitVec m) ⤳ Bool ⤳ Int ⤳ Int ⤳ BitVec k);
rule !bv_mk_bitwise_slicing_rec ($f) ($c) ($a) ($bs) ($bn) ($start) (-1) ↪ eo⋅⋅cons concat (!nary_app ($f) (extract ($start) (0) ($c)) (extract ($start) (0) ($a))) {|@bv_empty|}
with !bv_mk_bitwise_slicing_rec ($f) ($c) ($a) ({|@from_bools|} ($b) ($bs)) ($bn) ($start) {|end|} ↪ (let em1 ≔ eo⋅⋅add {|end|} (-1) in (let ep1 ≔ eo⋅⋅add {|end|} (1) in eo⋅⋅ite (eo⋅⋅eq ($b) ($bn)) (!bv_mk_bitwise_slicing_rec ($f) ($c) ($a) ($bs) ($b) ($start) em1) (eo⋅⋅cons concat (!nary_app ($f) (extract ($start) ep1 ($c)) (extract ($start) ep1 ($a))) (!bv_mk_bitwise_slicing_rec ($f) ($c) ($a) ($bs) ($b) {|end|} em1))));
symbol !bv_is_bitwise_slicing_op [n : τ Int] (f : τ ((BitVec n) ⤳ (BitVec n) ⤳ BitVec n))≔ eo⋅⋅or (eo⋅⋅eq f bvand) (eo⋅⋅eq f bvor) (eo⋅⋅eq f bvxor);
sequential symbol !bv_mk_bitwise_slicing [n : τ Int]: τ ((BitVec n) ⤳ BitVec n);
rule !bv_mk_bitwise_slicing ($f ($a1) ($a2)) ↪ eo⋅⋅list_singleton_elim concat ((let c ≔ !bv_get_first_const_child ($f ($a1) ($a2)) in eo⋅⋅requires (!bv_is_bitwise_slicing_op ($f)) true ((let wm1 ≔ eo⋅⋅add (eo⋅⋅len c) (-1) in !bv_mk_bitwise_slicing_rec ($f) c ((let nil ≔ eo⋅⋅nil ($f) (eo⋅⋅typeof ($a1)) in eo⋅⋅list_singleton_elim ($f) (eo⋅⋅list_erase ($f) ($f ($a1) ($a2)) c))) (eo⋅⋅list_rev {|@from_bools|} (!bv_mk_bitblast_step_const c)) (!bv_bit_set c wm1) wm1 wm1))));
