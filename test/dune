; Test configuration for eo2lp

; Shared test infrastructure library
(library
 (name test_infra)
 (libraries eo2lp unix)
 (modules test_infra))

; Core.eo tests
(test
 (name test_core)
 (libraries eo2lp test_infra)
 (modules test_core)
 (deps (source_tree ../eo))
 (action (chdir %{workspace_root} (run %{test}))))

; cpc-mini parsing tests
(test
 (name test_cpc_mini_parse)
 (libraries eo2lp test_infra)
 (modules test_cpc_mini_parse)
 (deps
   (source_tree ../eo)
   (source_tree ../cpc-mini))
 (action (chdir %{workspace_root} (run %{test}))))

; cpc-mini elaboration tests
(test
 (name test_cpc_mini_elaborate)
 (libraries eo2lp test_infra)
 (modules test_cpc_mini_elaborate)
 (deps
   (source_tree ../eo)
   (source_tree ../cpc-mini))
 (action (chdir %{workspace_root} (run %{test}))))

; cpc-mini encoding tests
(test
 (name test_cpc_mini_encode)
 (libraries eo2lp test_infra)
 (modules test_cpc_mini_encode)
 (deps
   (source_tree ../eo)
   (source_tree ../cpc-mini))
 (action (chdir %{workspace_root} (run %{test}))))

; ethos-tests (optional, doesn't fail build)
(test
 (name test_ethos)
 (libraries eo2lp test_infra)
 (modules test_ethos)
 (deps
   (source_tree ../eo)
   (source_tree ../ethos-tests))
 (action (chdir %{workspace_root} (run %{test}))))
